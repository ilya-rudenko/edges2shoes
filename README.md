# edges2shoes by Rudenko Ilya

### Описание задачи
Была выбрана задача реализации pix2pix архитектуры по этой [статье](https://arxiv.org/abs/1611.07004).

Суть задачи в том, чтобы по контуру обуви сгенерировать фотографию этой обуви.

![Пример](/pics/pic1.png)

Пример работы модели:

![Пример](/pics/pic2.png)

### Архитектура

Я повторил архитектуру из статьи: Generator - модифицированный UNet, Discriminator - сверточный "PatchGAN" классификатор.

Дискриминатор представляет собой модель, которая для каждого пикселя изображения пытается определить - он реальный или сгенерированный генератором.

### Loss-функция

В качестве основной функции потерь (obj_loss) была выбрана бинарная кросс-энтропия с логитами (nn.BCEWithLogitsLoss), потому что обычная бинарная кросс-энтропия давала артефакты на изображении.

Так как дискриминатор высчитывает вероятность "правдивости" для каждого пикселя, то для сравнения с реальным изображением брался тензор размера входных данных из единиц, а для сравнения со сгенерированным изображением брался тензор из нулей

#### Генератор:

Функция потерь генератора складывалась из основной функции потерь (obj_loss) между выходными данными дискриминатора для сгенерированного изображения и тензором из единиц (по сути обозначает то, насколько сильно генератор смог обмануть дискриминатор) и L1_loss (Среднее разницы сгенерированного по контуру изображения и реального).
Причем L1_loss умножался на LAMBDA = 10 (в статье было 100, но у меня дискриминатор плохо учился, и я решил уменьшить влияние L1 потерь).

#### Дискриминатор:

real_loss складывался из основной функции потерь между выходными данными дискриминатора для реального изображения и тензором из единиц

generated_loss складывался из основной функции потерь между выходными данными дискриминатора для фейкового изображения и тензором из нулей

Функция потерь дискриминатора складывалась из этих двух потерь.

### Обучение

Модель обучалась 10 эпох на датасете из 50 000 изображений.

Суммарное время обучения: 12621.5 секунд (3.5 часа)

### Запуск ноутбука и результаты обучения

#### Запуск ноутбука

Чтобы запустить мой ноутбук (или посмотреть результаты работы), можно открыть его на Kaggle [(ссылка)](https://www.kaggle.com/code/rudenkoilya/edges2shoes/notebook?scriptVersionId=136168169), и так-же запустить

#### Интерфейс для генерации

Интерфейс был сделан в Google Colab. Для запуска модели нужно сначала ее скачать (запустить первую ячейку) и запустить вторую ячейку для генерации изображения (после запуска ячейки внизу выбрать картинку, на которой хотите проверить модель).

Ячейка требует контуров в формате ".jpg".

[Ссылка на интерфейс](https://colab.research.google.com/drive/1C76hcCHk-8yl8mLZqPR09kPKO2-0lMtX?usp=sharing)

#### Веса модели

Веса представляют собой датасет на Kaggle [(ссылка)](https://www.kaggle.com/datasets/rudenkoilya/edges2shoes-weights). Номер после названия файла это номер эпохи, поэтому веса после окончания обучения модели это "generator_9.pt" и "discriminator_9.pt".

### Пример генерации собственноручно нарисованного контура из интерфейса в Colab:

![Пример](/pics/pic3.png)